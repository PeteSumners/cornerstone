import {assert, int} from '../base.js';

/**
 * Performance - performance monitoring and FPS tracking
 * Original location: engine.ts lines 303-343
 *
 * Tracks frame timing statistics using a rolling window of samples
 */

export class Performance {
  private now: any;
  private index: int;
  private ticks: int[];
  private last: number;
  private sum: int;

  constructor(now: any, samples: int) {
    assert(samples > 0);
    this.now = now;
    this.index = 0;
    this.ticks = new Array(samples).fill(0);
    this.last = 0;
    this.sum = 0;
  }

  begin() {
    this.last = this.now.now();
  }

  end() {
    const index = this.index;
    const next_index = index + 1;
    this.index = int(next_index < this.ticks.length ? next_index : 0);
    const tick = int(Math.round(1000 * (this.now.now() - this.last)));
    this.sum += tick - this.ticks[index];
    this.ticks[index] = tick;
  }

  frame(): int {
    return this.index;
  }

  max(): number {
    return Math.max.apply(null, this.ticks);
  }

  mean(): number {
    return this.sum / this.ticks.length;
  }
};
